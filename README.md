# ixe-app: Автономная система подготовки к ЕГЭ

## Описание

`ixe-app` — это личный проект для создания автономной, оффлайн-доступной системы подготовки к ЕГЭ, с потенциалом масштабирования до облачной адаптивной платформы. Цель проекта — предоставить мощный инструмент для отработки навыков через решение задач, с акцентом на гибкость, архитектурную чистоту и адаптивность (в будущем).

## Архитектура

Проект разработан с применением принципов:
*   **SOLID:** Обеспечивает гибкость, тестируемость и поддерживаемость кода.
*   **Domain-Driven Design (DDD):** Четкое разделение бизнес-логики (домен) от инфраструктуры (веб, база данных, скрэйпинг).
*   **Test-Driven Development (TDD):** Код разрабатывается через призму тестов, что гарантирует его корректность и устойчивость к рефакторингу.
*   **Dependency Inversion Principle (DIP):** Модули высокого уровня не зависят от модулей низкого уровня. Оба зависят от абстракций. Это позволяет легко подставлять разные реализации (например, разные способы загрузки ассетов).

### Слои

1.  **Domain:** Содержит бизнес-сущности (например, `Problem`), интерфейсы репозиториев и сервисов, доменные модели и валидации.
2.  **Application:** Содержит Use Cases, Value Objects, сервисы прикладного уровня (например, `PageScrapingService`), фабрики.
3.  **Infrastructure:** Содержит реализации интерфейсов из Domain (например, `SQLAlchemyProblemRepository`, `BrowserPoolServiceAdapter`), адаптеры для внешних сервисов, HTML-процессоры.
4.  **Presentation:** CLI-хендлер, в будущем PWA и Telegram Mini App.

## Технологии

*   **Язык:** Python 3.12
*   **Веб-фреймворк:** FastAPI
*   **ORM:** SQLAlchemy (aiosqlite)
*   **Скрэйпинг:** Playwright
*   **Поиск:** Qdrant (встроенный в приложение)
*   **Тестирование:** pytest
*   **Конфигурация:** pydantic (centralized config)
*   **CI/CD:** GitHub Actions (шаблон)

## Установка и запуск (локально)

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
    cd ixe-app
    ```

2.  **Создайте виртуальное окружение:**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Linux/Mac
    # или
    venv\Scripts\activate  # Windows
    ```

3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Установите Playwright браузеры:**
    ```bash
    playwright install chromium
    ```

5.  **Запустите скрэйпинг (например, для математики):**
    ```bash
    python -m src.presentation.cli.scraping_cli_handler math --mode full
    ```

## Структура проекта

```
ixe/
├── src/
│   ├── application/          # Слой приложения (Use Cases, VO, сервисы)
│   ├── domain/               # Доменный слой (сущности, интерфейсы)
│   ├── infrastructure/       # Инфраструктурный слой (реализации)
│   ├── presentation/         # Слой представления (CLI, PWA - в будущем)
│   └── core/                 # Общие настройки (конфигурация)
├── tests/                    # Тесты (unit, integration, architecture)
├── requirements.txt          # Зависимости Python
├── .env.example              # Пример файла конфигурации
├── .gitignore
└── README.md                 # Этот файл
```

## Рефакторинг и ключевые архитектурные решения

*   **Изолирование домена:** `Problem` и другие доменные сущности не зависят от инфраструктуры (базы данных, веб-фреймворка).
*   **Интерфейсы как контракты:** `IProblemRepository`, `IBrowserService`, `IAssetDownloader` определяют *что* нужно сделать, а не *как*. Это позволяет легко подставлять разные реализации.
*   **Принцип единственной ответственности (SRP):** Каждый класс/модуль имеет одну причину для изменения.
*   **Рефакторинг `extract_block_pairs`:** Разделение сложной логики на ` _extract_block_pairs_by_header_body_pattern` и `_extract_block_pairs_by_qblocks_pattern_with_grouping` для улучшения читаемости и тестируемости.
*   **Валидация в `Problem`:** Вынесена в отдельные классы-валидаторы (`TextValidator`, `DifficultyValidator` и т.д.) и объединена через `CompositeProblemValidator`.
*   **Инверсия зависимостей в `ImageScriptProcessor`:** Заменена зависимость от `playwright.Page` на интерфейс `IAssetDownloader`, улучшая тестируемость и убирая нарушение DIP.
*   **Группировка заданий:** Реализована логика обработки `qblock`-ов с общим контекстом, где несколько индивидуальных заданий объединяются в PWA, но сохраняются отдельно для интеграции с формами ФИПИ.

## Планы на будущее

*   Завершить скрэйпинг всех предметов.
*   Реализовать PWA с оффлайн-режимом.
*   Добавить Telegram Mini App.
*   Разработать систему адаптивного обучения (в облаке).
*   Интеграция с оригинальной системой проверки ФИПИ и кэширование ответов.

## Лицензия

[Укажите вашу лицензию, если применимо]
