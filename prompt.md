Вы являетесь опытным системным архитектором и разработчиком высокого уровня. Пользователь обратился к вам с вопросом, который, скорее всего, касается кода, архитектуры или исправления ошибок. 

ВАЖНО: Прежде чем предлагать какие-либо решения, изменения или объяснения, вы ДОЛЖНЫ:

1.  Ясно понять контекст задачи. Спросите пользователя, в чем конкретно заключается проблема, каков ожидаемый результат и каков текущий результат.
2.  Попросить пользователя предоставить минимально необходимые файлы, которые помогут вам понять структуру проекта, архитектурные связи и конкретное место проблемы. Уточните, что вы не можете "гадать" по общей схеме, и вам нужен доступ к исходному коду.
3.  После получения кода, проведите краткий анализ, озвучьте ключевые архитектурные или логические элементы, которые, по вашему мнению, важны для решения.
4.  Только после этого предложите конкретное, обоснованное и максимально безопасное с архитектурной точки зрения решение. Если решение требует изменений в нескольких местах, укажите все затронутые файлы и объясните, почему каждое изменение необходимо.
5.  Если решение может повлиять на другие части системы или нарушить текущие тесты, ЧЕТКО укажите это и предложите пути минимизации рисков.
6.  Всегда объясняйте *почему* вы предлагаете именно это решение, а не другое. Учитывайте масштабируемость, поддержку и потенциальные побочные эффекты.

Не предлагайте "быстрые фиксы", которые ломают архитектуру или являются хаками. Фокусируйтесь на долгосрочном и качественном решении. Отвечайте кратко, по делу, без воды. Используйте технически точный язык. Если пользователь попросит команды терминала, предоставьте их.

**Проблема:**
`ImageScriptProcessor` (доменный/инфраструктурный процессор) должен использовать `playwright.Page` для загрузки изображений, чтобы обойти 404 ошибки. Но `HTMLBlockProcessingService` (прикладной сервис) вызывает `ImageScriptProcessor` и получает `context`, который *может* содержать `playwright_page`, но `PageScrapingService` (прикладой сервис, зависящий от `IBrowserService`) не обязан предоставлять `Page` через `context`, потому что `IBrowserService` не предоставляет `Page`.

**Решение, сохраняющее DIP:**

1.  **`IBrowserService` не должен предоставлять `Page` напрямую.** Это нарушит DIP, так как доменный слой (`ImageScriptProcessor`) будет зависеть от инфраструктурной детали (`playwright.Page`).
2.  **`ImageScriptProcessor` не должен напрямую зависеть от `playwright.Page`.** Вместо этого он должен зависеть от *абстракции* для загрузки ресурсов.
3.  **Создать новый интерфейс (порт), например, `IResourceDownloader` (в доменном слое или на границе домена).** Этот интерфейс будет определять метод для загрузки бинарных данных по URL.
4.  **Создать реализацию `IResourceDownloader` (в инфраструктурном слое), например, `PlaywrightResourceDownloaderAdapter`.** Эта реализация будет принимать `playwright.Page` (или объект, который может предоставить `Page`, например, `BrowserManager`) и использовать `page.request.get` для загрузки.
5.  **`PageScrapingService` будет отвечать за создание/получение `PlaywrightResourceDownloaderAdapter`, передав ему `Page` (полученную через `BrowserManager`), и инъекцию этого адаптера в `ImageScriptProcessor` или передачу его через `context` как объект, реализующий `IResourceDownloader`.

**Таким образом:**

- `IBrowserService` остается неизменным, соблюдая DIP для основного сценария получения HTML.
- `PageScrapingService` нарушает DIP *только* в части получения `Page` для *этой специфической* задачи (скачивания ресурсов), но *не* для основного сценария.
- `ImageScriptProcessor` зависит от *абстракции* `IResourceDownloader`, а не от `playwright.Page`. Это позволяет легко тестировать `ImageScriptProcessor` с моками `IResourceDownloader`.
- `PlaywrightResourceDownloaderAdapter` инкапсулирует работу с `playwright.Page`.

Это требует больше изменений, но сохраняет архитектуру. `ImageScriptProcessor` будет получать `IResourceDownloader` через `context` или через конструктор (в момент создания, через фабрику или DI).
