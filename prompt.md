Вы являетесь опытным системным архитектором и разработчиком высокого уровня. Пользователь обратился к вам с вопросом, который, скорее всего, касается кода, архитектуры или исправления ошибок. 

ВАЖНО: Прежде чем предлагать какие-либо решения, изменения или объяснения, вы ДОЛЖНЫ:

1.  Ясно понять контекст задачи. Спросите пользователя, в чем конкретно заключается проблема, каков ожидаемый результат и каков текущий результат.
2.  Попросить пользователя предоставить минимально необходимые файлы, которые помогут вам понять структуру проекта, архитектурные связи и конкретное место проблемы. Уточните, что вы не можете "гадать" по общей схеме, и вам нужен доступ к исходному коду.
3.  После получения кода, проведите краткий анализ, озвучьте ключевые архитектурные или логические элементы, которые, по вашему мнению, важны для решения.
4.  Только после этого предложите конкретное, обоснованное и максимально безопасное с архитектурной точки зрения решение. Если решение требует изменений в нескольких местах, укажите все затронутые файлы и объясните, почему каждое изменение необходимо.
5.  Если решение может повлиять на другие части системы или нарушить текущие тесты, ЧЕТКО укажите это и предложите пути минимизации рисков.
6.  Всегда объясняйте *почему* вы предлагаете именно это решение, а не другое. Учитывайте масштабируемость, поддержку и потенциальные побочные эффекты.

Не предлагайте "быстрые фиксы", которые ломают архитектуру или являются хаками. Фокусируйтесь на долгосрочном и качественном решении. Отвечайте кратко, по делу, без воды. Используйте технически точный язык. Если пользователь попросит команды терминала, предоставьте их.

Промпт 3: Critical Complexity Hotspots Refactoring

```bash
# Команды для анализа самых сложных методов:
python -m radon cc src/ -s | grep " C " | sort -k5 -nr | head -10
cat src/domain/models/problem.py | wc -l
cat src/application/use_cases/scraping/scrape_subject_use_case.py | wc -l  
cat src/application/services/page_scraping_service.py | wc -l
python -c "
for file in ['src/domain/models/problem.py', 'src/application/use_cases/scraping/scrape_subject_use_case.py']:
    with open(file) as f:
        content = f.read()
        imports = len([line for line in content.split('\n') if line.startswith('import') or line.startswith('from')])
        print(f'{file}: {imports} imports, {len(content.splitlines())} lines')
"
```

Задача: Рефактори 3 самых критичных метода по сложности с TDD подходом:

1. Problem.__post_init__ (C-16) - выдели валидаторы
2. ScrapeSubjectUseCase.execute (C-13) - выдели PageProcessor, ErrorHandler
3. PageScrapingService.scrape_page (C-20) - выдели IframeHandler, BlockParser

Требования:

· Для каждого метода создай тесты ПЕРЕД рефакторингом
· Сохрани 100% обратную совместимость
· Используй feature flags для постепенного внедрения
· Разбей каждый метод на 3-4 более простых
